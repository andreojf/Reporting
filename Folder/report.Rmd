---
title: "Reporting mensuel sur le risque de crédit - `r params$arrete`"
date: "`r Sys.time()`"
output:
  html_document:
    toc: yes
    toc_depth: 2
params:
  arrete: '2020-12-31'
  prev1Arrete: '2020-11-30'
  prev2Arrete: '2020-10-31'
  moisArrete: Decembre
  anneeArrete: 2020
  pays: Burkina

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo=FALSE}
library(shiny)
```

```{r include=FALSE, message=FALSE, warning=FALSE}
source("CodesCredit/importData.R")
source("CodesCredit/preparation.R")
source("CodesCredit/portef_bancaire.R")
source("CodesCredit/byNotation.R")
source("CodesCredit/bySegment.R")
source("CodesCredit/byBCEAO.R")
source("CodesCredit/CDLparAge.R")
source("CodesCredit/EngagementsHorsBilan.R")
source("CodesCredit/50PlusGrosEngagements.R")
```


# Situation du portefeuille

## Vision par pays

Cette section décrit la situation du portefeuille de chacun des (08) entités. 

### Burkina
```{r echo=FALSE, message=FALSE}
#source("portef_bancaire.R")
```

### Benin
```{r echo=FALSE, message=FALSE}
country = "Benin"
```

L'évolution du portefeuille de CBI **`r country`** sur les (03) trois derniers mois.

```{r echo=FALSE, message=FALSE}
library(plyr)
country = "Benin"
final.df %>%
  pfEvol(pays = country) %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation du portefeuille détaillée de CBI ", country, "**", sep = "")),
    subtitle = paste("arreté du",params$arrete)
  )
```

\
\
La synthèse suivant les Sains, Restructurés et Douteux et litigieux est reporté dans le tableau suivant:

```{r echo=FALSE, message=FALSE}
final.df %>%
  pfEvolGlobal(pays = country) %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation globale du portefeuille de CBI ", country, "**", sep = "")),
    subtitle = paste("arreté du",params$arrete)
  ) 
```
\
\

### Côte d'Ivoire
```{r echo=FALSE, message=FALSE}
country = "CI"
```

L'évolution du portefeuille de CBI **`r country`** sur les (03) trois derniers mois.

```{r echo=FALSE, message=FALSE}
final.df %>%
  pfEvol(pays = country) %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation du portefeuille détaillée de CBI ", country, "**", sep = "")),
    subtitle = paste("arreté du",params$arrete)
  )
```

\
\
La synthèse suivant les Sains, Restructurés et Douteux et litigieux est reporté dans le tableau suivant:

```{r echo=FALSE, message=FALSE}
final.df %>%
  pfEvolGlobal(pays = country) %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation globale du portefeuille de CBI ", country, "**", sep = "")),
    subtitle = paste("arreté du",params$arrete)
  ) 
```
\
\


### Guinée
```{r echo=FALSE, message=FALSE}
country = "Benin"
```

### Mali
```{r echo=FALSE, message=FALSE}
country = "ML"
```

L'évolution du portefeuille de CBI **`r country`** sur les (03) trois derniers mois.

```{r echo=FALSE, message=FALSE}
final.df %>%
  pfEvol(pays = country) %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation du portefeuille détaillée de CBI ", country, "**", sep = "")),
    subtitle = paste("arreté du",params$arrete)
  )
```

\
\
La synthèse suivant les Sains, Restructurés et Douteux et litigieux est reporté dans le tableau suivant:
  
  ```{r echo=FALSE, message=FALSE}
final.df %>%
  pfEvolGlobal(pays = country) %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation globale du portefeuille de CBI ", country, "**", sep = "")),
    subtitle = paste("arreté du",params$arrete)
  ) 
```
\
\

### Niger
```{r echo=FALSE, message=FALSE}
country = "NG"
```

L'évolution du portefeuille de CBI **`r country`** sur les (03) trois derniers mois.

```{r echo=FALSE, message=FALSE}
final.df %>%
  pfEvol(pays = country) %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation du portefeuille détaillée de CBI ", country, "**", sep = "")),
    subtitle = paste("arreté du",params$arrete)
  )
```

\
\
La synthèse suivant les Sains, Restructurés et Douteux et litigieux est reporté dans le tableau suivant:

```{r echo=FALSE, message=FALSE}
final.df %>%
  pfEvolGlobal(pays = country) %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation globale du portefeuille de CBI ", country, "**", sep = "")),
    subtitle = paste("arreté du",params$arrete)
  ) 
```
\
\

### Sénégal
```{r echo=FALSE, message=FALSE}
country = "SN"
```

L'évolution du portefeuille de CBI **`r country`** sur les (03) trois derniers mois.

```{r echo=FALSE, message=FALSE}
final.df %>%
  pfEvol(pays = country) %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation du portefeuille détaillée de CBI ", country, "**", sep = "")),
    subtitle = paste("arreté du",params$arrete)
  )
```

\
\
La synthèse suivant les Sains, Restructurés et Douteux et litigieux est reporté dans le tableau suivant:
  
  ```{r echo=FALSE, message=FALSE}
final.df %>%
  pfEvolGlobal(pays = country) %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation globale du portefeuille de CBI ", country, "**", sep = "")),
    subtitle = paste("arreté du",params$arrete)
  ) 
```
\
\

### Togo 
```{r echo=FALSE, message=FALSE}
country = "TG"
```

L'évolution du portefeuille de CBI **`r country`** sur les (03) trois derniers mois.

```{r echo=FALSE, message=FALSE}
final.df %>%
  pfEvol(pays = country) %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation du portefeuille détaillée de CBI ", country, "**", sep = "")),
    subtitle = paste("arreté du",params$arrete)
  )
```

\
\
La synthèse suivant les Sains, Restructurés et Douteux et litigieux est reporté dans le tableau suivant:

```{r echo=FALSE, message=FALSE}
final.df %>%
  pfEvolGlobal(pays = country) %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation globale du portefeuille de CBI ", country, "**", sep = "")),
    subtitle = paste("arreté du",params$arrete)
  ) 
```
\
\


## Vision agrégée

La vision agrégée reprend les mêmes informations que précédemment. Les chiffres sont obtenus en sommant les montants de toutes entités. 
\

```{r echo=FALSE, message=FALSE}
final.df %>%
  pfAgrege %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation globale du portefeuille du groupe**")),
    subtitle = paste("arreté du",params$arrete)
  )
```

\
\

```{r echo=FALSE, message=FALSE}
final.df %>%
  pfAgregeGlobal %>%
  pfFormatTable(country = country, params = params) %>%
  tab_header(
    title = md(paste("**Situation globale du portefeuille du groupe**")),
    subtitle = paste("arreté du",params$arrete)
  )
```
\
\
**Observations:**
`r final.df %>% pfAgregeGlobal %>% storyPtf `

# Répartition suivant la qualité 


```{r echo=FALSE, message=FALSE}
detach("package:plyr", unload = TRUE)
final.df %>%
  notationParPays2(arrete = params$arrete) 
```
\
\

## Vision consolidée
```{r echo=FALSE, message=FALSE}
# detach("package:plyr", unload = TRUE)
final.df %>%
  notationConsolidee(arrete = params$arrete) 
```

\
\

## Matrice de passage

```{r echo=FALSE, message=FALSE}
d = as.Date(params$arrete)
transTab <- final.df %>%
  transNotation("Benin", d, 1)
transTab$transitionPropGt
```


**Observations:**
`r transTab$transitionProp %>% storyNotation `


# Répartition suivant le segment


```{r echo=FALSE, message=FALSE}
final.df %>%
  SegmentParPays(params$arrete)
```

```{r echo=FALSE, message=FALSE}
final.df %>%
  SegmentConsolide(params$arrete)
```

```{r echo=FALSE, message=FALSE}
d = as.Date(params$arrete)
transTab <- final.df %>%
  transSegment("Benin", d, 1)
transTab$transitionPropGt
```



# Répartition suivant le secteur d'activité
```{r echo=FALSE, message=FALSE}
final.df %>%
  BCEAOparPays("2020-12-31") %>%
  tab_header(
    title = md(paste("**Situation du portefeuille détaillée de CBI ", country, "**", sep = "")),
    subtitle = paste("arreté du",params$arrete)
  )
```

```{r echo=FALSE, message=FALSE}
final.df %>%
  BCEAOConsolidee("2020-12-31")
```

```{r echo=FALSE, message=FALSE}
```

```{r echo=FALSE, message=FALSE}
```

```{r echo=FALSE, message=FALSE}
```
# CDL par age

```{r echo=FALSE, message=FALSE}
arrete = as.Date("31/12/2020", format="%d/%m/%Y")
final.df %>%
  declassementparPays(arrete)
```

```{r echo=FALSE, message=FALSE}
arrete = as.Date("31/12/2020", format="%d/%m/%Y")
final.df %>%
  declassementConsolidee(arrete)
```

```{r echo=FALSE, message=FALSE}
```

```{r echo=FALSE, message=FALSE}
```

```{r echo=FALSE, message=FALSE}
```

```{r echo=FALSE, message=FALSE}
```
# Engagements hors bilan
```{r echo=FALSE, message=FALSE}
final.df %>%
  HorsBilanparPays("2020-12-31", avalTraite)
```

```{r echo=FALSE, message=FALSE}
```

```{r echo=FALSE, message=FALSE}
```

```{r echo=FALSE, message=FALSE}
```
# 50 plus gros engagements

```{r echo=FALSE, message=FALSE}
top50 <- final.df %>%
  top50ParPays(params$arrete)
```


```{r echo=FALSE, message=FALSE}
final.df %>%
  top50Consolidee(params$arrete) 
```

# Situation consolidée du portefeuille
# 